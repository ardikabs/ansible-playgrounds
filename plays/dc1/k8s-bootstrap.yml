---

- name: Ensure python is present
  hosts: all
  become: yes
  gather_facts: no
  pre_tasks:
    - name: Ensure python 2.7 is present
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
      register: output
      changed_when:
        - output.stdout != ""
        - output.stdout != "\r\n"

- name: Bootstrap etcd Cluster
  hosts: etcd
  become: yes
  gather_facts: yes
  roles:
  - etcd

- name: Bootstrap Master Nodes
  hosts: masters
  become: yes
  gather_facts: yes
  vars:
    - kube_bootstrap: true
  roles:
  - kubernetes/master

- name: Bootstrap Worker Nodes
  hosts: workers
  become: yes
  gather_facts: yes
  vars:
    - kube_bootstrap: true
  roles:
  - kubernetes/worker
